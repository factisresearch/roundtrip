<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Impl.lhs</title>
</head>
<body>
<html>
<head>
<title>Roundtrip Tutorial</title>
</head>
<body>

<h1>Roundtrip Tutorial</h1>

<i>DRAFT DRAFT DRAFT</i>

<h2>Testing and using the specifications</h2>

<pre>&gt; <b><font color=Blue>import</font></b> Spec
&gt;
&gt; <b><font color=Blue>import</font></b> Data.Maybe (fromJust, isJust)
&gt; <b><font color=Blue>import</font></b> Control.Monad (liftM2)
&gt;
&gt; <b><font color=Blue>import</font></b> Test.QuickCheck
&gt;
&gt; <b><font color=Blue>import</font></b> Text.Roundtrip.Parser
&gt; <b><font color=Blue>import</font></b> Text.Roundtrip.Printer
&gt;
&gt; <b><font color=Blue>import</font></b> Text.Roundtrip.Xml.Parser
&gt; <b><font color=Blue>import</font></b> Text.Roundtrip.Xml.Printer
&gt;
&gt; <i>testParser</i> <font color=Red>::</font> Either ParseError Expr
&gt; <i>testParser</i> <font color=Red>=</font> runStringParser pExpr <font color=Magenta>"&lt;string&gt;"</font> <font color=Magenta>"(1+(foo+2))"</font>
&gt;
&gt; <i>testPrinter</i> <font color=Red>::</font> Maybe String
&gt; <i>testPrinter</i> <font color=Red>=</font> runPrinter pExpr (Plus (Lit 1) (Plus (Var <font color=Magenta>"foo"</font>) (Lit 2)))
&gt;
&gt; <b><font color=Blue>instance</font></b> Arbitrary Expr <b><font color=Blue>where</font></b>
&gt;     arbitrary <font color=Red>=</font> sized arbExpr
&gt;         <b><font color=Blue>where</font></b> arbExpr 0 <font color=Red>=</font> frequency simpleExprs
&gt;               arbExpr n <font color=Red>=</font> frequency (simpleExprs ++
&gt;                                      <font color=Red>[</font>(5, liftM2 Plus (arbExpr (n `div` 2))
&gt;                                                       (arbExpr (n `div` 2)))<font color=Red>]</font>)
&gt;               simpleExprs <font color=Red>=</font> <font color=Red>[</font>(1, <b><font color=Blue>do</font></b> n <font color=Red>&lt;-</font> arbitrary
&gt;                                     return (Lit n)),
&gt;                              (1, <b><font color=Blue>do</font></b> v <font color=Red>&lt;-</font> elements letters
&gt;                                     vs <font color=Red>&lt;-</font> listOf (elements lettersOrDigits)
&gt;                                     return (Var (v<b><font color=Green>:</font></b>vs)))<font color=Red>]</font>
&gt;               letters <font color=Red>=</font> <font color=Red>[</font><font color=Magenta>'a'</font><font color=Red>..</font><font color=Magenta>'z'</font><font color=Red>]</font> ++ <font color=Red>[</font><font color=Magenta>'A'</font><font color=Red>..</font><font color=Magenta>'Z'</font><font color=Red>]</font>
&gt;               lettersOrDigits <font color=Red>=</font> letters ++ <font color=Red>[</font><font color=Magenta>'0'</font><font color=Red>..</font><font color=Magenta>'9'</font><font color=Red>]</font>
&gt;     shrink (Var <b><font color=Blue>_</font></b>) <font color=Red>=</font> []
&gt;     shrink (Lit <b><font color=Blue>_</font></b>) <font color=Red>=</font> []
&gt;     shrink (Plus e1 e2) <font color=Red>=</font> <font color=Red>[</font>e1, e2<font color=Red>]</font>
&gt;
&gt; <i>prop_printerDoesNotFail</i> <font color=Red>::</font> Expr <font color=Red>-&gt;</font> Bool
&gt; <i>prop_printerDoesNotFail</i> expr <font color=Red>=</font> isJust (runStringPrinter pExpr expr)
&gt;
&gt; <i>prop_printerParserInverse</i> <font color=Red>::</font> Expr <font color=Red>-&gt;</font> Bool
&gt; <i>prop_printerParserInverse</i> expr <font color=Red>=</font>
&gt;     <b><font color=Blue>let</font></b> code <font color=Red>=</font> fromJust (runStringPrinter pExpr expr)
&gt;     <b><font color=Blue>in</font></b> <b><font color=Blue>case</font></b> runStringParser pExpr <font color=Magenta>"&lt;string&gt;"</font> code <b><font color=Blue>of</font></b>
&gt;          Left err <font color=Red>-&gt;</font> error (show err)
&gt;          Right expr' <font color=Red>-&gt;</font> expr == expr'
&gt;
&gt; <i>testXmlParser</i> <font color=Red>::</font> Either ParseError Expr
&gt; <i>testXmlParser</i> <font color=Red>=</font> runXmlParserString pXmlExpr <font color=Magenta>"&lt;string&gt;"</font> defaultEntityRenderer
&gt;                   <font color=Magenta>"&lt;plus&gt;&lt;lit value=\"1\"/&gt;&lt;plus&gt;&lt;var name=\"foo\"/&gt;&lt;lit value=\"2\"/&gt;&lt;/plus&gt;&lt;/plus&gt;"</font>
&gt;
&gt; <i>testXmlPrinter</i> <font color=Red>::</font> Maybe String
&gt; <i>testXmlPrinter</i> <font color=Red>=</font> runXmlPrinterString pXmlExpr (Plus (Lit 1) (Plus (Var <font color=Magenta>"foo"</font>) (Lit 2)))
&gt;
&gt; <i>prop_xmlPrinterDoesNotFail</i> <font color=Red>::</font> Expr <font color=Red>-&gt;</font> Bool
&gt; <i>prop_xmlPrinterDoesNotFail</i> expr <font color=Red>=</font> isJust (runXmlPrinterString pXmlExpr expr)
&gt;
&gt; <i>prop_xmlPrinterParserInverse</i> <font color=Red>::</font> Expr <font color=Red>-&gt;</font> Bool
&gt; <i>prop_xmlPrinterParserInverse</i> expr <font color=Red>=</font>
&gt;     <b><font color=Blue>let</font></b> code <font color=Red>=</font> fromJust (runXmlPrinterString pXmlExpr expr)
&gt;     <b><font color=Blue>in</font></b> <b><font color=Blue>case</font></b> runXmlParserString pXmlExpr <font color=Magenta>"&lt;string&gt;"</font> defaultEntityRenderer code <b><font color=Blue>of</font></b>
&gt;          Left err <font color=Red>-&gt;</font> error (show err)
&gt;          Right expr' <font color=Red>-&gt;</font> expr == expr'
&gt;
&gt; <i>allProperties</i> <font color=Red>=</font> <font color=Red>[</font>prop_printerDoesNotFail, prop_printerParserInverse,
&gt;                  prop_xmlPrinterDoesNotFail, prop_xmlPrinterParserInverse<font color=Red>]</font>
&gt;
&gt; <i>qc</i> <font color=Red>=</font> mapM_ quickCheck allProperties
</pre>
</body>
</html>

</body>
</html>