<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Spec.lhs</title>
</head>
<body>
<html>
<head>
<title>Roundtrip Tutorial</title>
</head>
<body>

<h1>Roundtrip Tutorial</h1>

<i>DRAFT DRAFT DRAFT</i>

<p>
Roundtrip allows the definition of bidirectional (de-)serialization
specifications. The specification language is based on the ideas described
in the paper <i>Invertible Syntax Descriptions: Unifying Parsing and Pretty
Printing</i> by Tillmann Rendel and Klaus Ostermann, Haskell Symposium 2010
(<a href="http://www.informatik.uni-marburg.de/~rendel/unparse/rendel10invertible.pdf">online version</a>).
</p>

<p>
Author: Stefan Wehr (<code>wehr AT factisresearch DOT com</code>)<br>
Roundtrip on hackage:
<ul>
  <li><a href="http://hackage.haskell.org/package/roundtrip">roundtrip</a></li>
  <li><a href="http://hackage.haskell.org/package/roundtrip-string">roundtrip-string</a></li>
  <li><a href="http://hackage.haskell.org/package/roundtrip-xml">roundtrip-xml</a></li>
</ul>
</p>

<h2>Specification for parsing/printing expressions from strings</h2>

<pre>&gt; <i><font color=Black>{-# LANGUAGE OverloadedStrings, TemplateHaskell #-}</font></i>
&gt; <b><font color=Blue>module</font></b> Spec <b><font color=Blue>where</font></b>
&gt;
&gt; <b><font color=Blue>import</font></b> Data.Char (isLetter, isDigit)
&gt; <b><font color=Blue>import</font></b> Text.Roundtrip
&gt;
&gt; <b><font color=Blue>data</font></b> Expr <font color=Red>=</font> Var String
&gt;           <font color=Red>|</font> Lit Int
&gt;           <font color=Red>|</font> Plus Expr Expr
&gt;             <b><font color=Blue>deriving</font></b> (Show, Eq)
&gt;
&gt; $(defineIsomorphisms <font color=Magenta>'</font><font color=Magenta>'</font>Expr)
&gt;
&gt; <i>letter</i> <font color=Red>::</font> StringSyntax d <font color=Red>=&gt;</font> d Char
&gt; <i>letter</i> <font color=Red>=</font>  token isLetter
&gt;
&gt; <i>variable</i> <font color=Red>::</font> StringSyntax d <font color=Red>=&gt;</font> d String
&gt; <i>variable</i> <font color=Red>=</font> cons &lt;$&gt; letter &lt;*&gt; many (letter &lt;|&gt; digit)
&gt;
&gt; <i>digit</i> <font color=Red>::</font> StringSyntax d <font color=Red>=&gt;</font> d Char
&gt; <i>digit</i> <font color=Red>=</font> token isDigit
&gt;
&gt; <i>integer</i> <font color=Red>::</font> StringSyntax d <font color=Red>=&gt;</font> d Int
&gt; <i>integer</i> <font color=Red>=</font> signedIntIso &lt;$&gt; optionalBool (char <font color=Magenta>'-'</font>) &lt;*&gt; (readShowIso &lt;$&gt; many1 digit)
&gt;     <b><font color=Blue>where</font></b>
&gt;       signedIntIso <font color=Red>::</font> Iso (Bool, Int) Int
&gt;       signedIntIso <font color=Red>=</font> <b><font color=Blue>let</font></b> f (True, i) <font color=Red>=</font> Just (<i><font color=Black>-</font></i>i)
&gt;                          f (False, i) <font color=Red>=</font> Just i
&gt;                          g i <font color=Red>=</font> Just (i &lt; 0, abs i)
&gt;                      <b><font color=Blue>in</font></b> unsafeMakeIso f g
&gt;
&gt; <i>pExpr</i> <font color=Red>::</font> StringSyntax d <font color=Red>=&gt;</font> d Expr
&gt; <i>pExpr</i> <font color=Red>=</font> var  &lt;$&gt; variable
&gt;     &lt;|&gt; lit  &lt;$&gt; integer
&gt;     &lt;|&gt; plus &lt;$&gt; (char <font color=Magenta>'('</font> *&gt; pExpr &lt;*&gt;
&gt;                   char <font color=Magenta>'+'</font> *&gt; pExpr &lt;* char <font color=Magenta>')'</font>)
</pre>
<h2>Specification for parsing/printing expressions from an XML tree</h2>

<pre>&gt; <i><font color=Black>{-
&gt; &lt;plus&gt;
&gt;   &lt;var name="foo"/&gt;
&gt;   &lt;lit value="123"/&gt;
&gt; &lt;/plus&gt;
&gt; -}</font></i>
&gt;
&gt; <i>xmlVariable</i> <font color=Red>::</font> XmlSyntax d <font color=Red>=&gt;</font> d String
&gt; <i>xmlVariable</i> <font color=Red>=</font> xmlElem <font color=Magenta>"var"</font> (xmlAttr <font color=Magenta>"name"</font> textStringIso)
&gt;
&gt; <i>xmlInteger</i> <font color=Red>::</font> XmlSyntax d <font color=Red>=&gt;</font> d Int
&gt; <i>xmlInteger</i> <font color=Red>=</font> xmlElem <font color=Magenta>"lit"</font> (xmlAttr <font color=Magenta>"value"</font> readShowTextIso)
&gt;
&gt; <i>pXmlExpr</i> <font color=Red>::</font> XmlSyntax d <font color=Red>=&gt;</font> d Expr
&gt; <i>pXmlExpr</i> <font color=Red>=</font> var  &lt;$&gt; xmlVariable
&gt;        &lt;|&gt; lit  &lt;$&gt; xmlInteger
&gt;        &lt;|&gt; plus &lt;$&gt; xmlElem <font color=Magenta>"plus"</font> (pXmlExpr &lt;*&gt; pXmlExpr)
</pre>
The <code><a href="Impl.html">Impl<a/></code> module shows these specifications in action.

</body>
</html>

</body>
</html>